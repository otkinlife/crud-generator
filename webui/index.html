<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRUD Generator - Table Configuration Manager</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://unpkg.com/sql-formatter@4.0.2/dist/sql-formatter.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        .config-editor { 
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace; 
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
        }
        .sidebar { height: 100vh; overflow-y: auto; background-color: #f8f9fa; }
        .main-content { height: 100vh; overflow-y: auto; }
        .config-item {
            cursor: pointer; padding: 12px; margin: 8px 0; border-radius: 6px; 
            border: 1px solid #dee2e6; transition: all 0.2s;
        }
        .config-item:hover { background-color: #e9ecef; transform: translateY(-1px); }
        .config-item.active { background-color: #fcfcfc; color: #c97171; }
        .connection-badge { font-size: 0.75em; }
        
        /* SQLÁºñËæëÂô®Ê†∑Âºè */
        .sql-editor {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            resize: vertical;
            min-height: 200px;
        }
        
        /* Â≠óÊÆµÈ™åËØÅÊ†∑Âºè */
        .field-invalid {
            border-color: #dc3545 !important;
            background-color: #f8d7da !important;
        }
        .field-error {
            color: #dc3545;
            font-size: 0.875em;
            margin-top: 0.25rem;
        }
        .fields-info {
            background-color: #e7f3ff;
            border: 1px solid #b3d9ff;
            border-radius: 6px;
            padding: 10px;
            margin: 10px 0;
            font-size: 0.9em;
        }
        .field-tag {
            display: inline-block;
            background-color: #007bff;
            color: white;
            padding: 2px 8px;
            margin: 2px;
            border-radius: 12px;
            font-size: 0.8em;
        }
        .cursor-pointer {
            cursor: pointer;
        }
        .sortable-item {
            cursor: move;
            transition: all 0.2s;
        }
        .sortable-item:hover {
            background-color: #f8f9fa;
        }
        .sortable-item.dragging {
            opacity: 0.5;
        }
        .drag-handle {
            cursor: move;
            color: #6c757d;
            font-size: 1.2em;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- ÁôªÂΩïÊ®°ÊÄÅÊ°Ü -->
        <div class="modal fade" id="loginModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
            <div class="modal-dialog modal-sm">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Áî®Êà∑ÁôªÂΩï</h5>
                    </div>
                    <div class="modal-body">
                        <div v-if="loginError" class="alert alert-danger" role="alert">
                            {{ loginError }}
                        </div>
                        <form @submit.prevent="login">
                            <div class="mb-3">
                                <label class="form-label">Áî®Êà∑Âêç</label>
                                <input v-model="loginForm.username" class="form-control" required autofocus>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">ÂØÜÁ†Å</label>
                                <input v-model="loginForm.password" type="password" class="form-control" required>
                            </div>
                            <div class="d-grid">
                                <button type="submit" class="btn btn-primary" :disabled="loggingIn">
                                    {{ loggingIn ? 'ÁôªÂΩï‰∏≠...' : 'ÁôªÂΩï' }}
                                </button>
                            </div>
                        </form>
                        <div class="mt-3 text-muted small">
                            <p>ÈªòËÆ§Ë¥¶Êà∑:</p>
                            <p>ÁÆ°ÁêÜÂëò: admin / admin123</p>
                            <p>ÊôÆÈÄöÁî®Êà∑: user / user123</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ‰∏ªÁïåÈù¢ -->
        <div v-if="isAuthenticated" class="container-fluid">
            <div class="row">
                <!-- È°∂ÈÉ®ÂØºËà™ -->
                <div class="col-12 bg-light border-bottom p-2">
                    <div class="d-flex justify-content-between align-items-center">
                        <h6 class="mb-0">CRUD Generator</h6>
                        <div class="d-flex align-items-center">
                            <span class="me-3 text-muted">Ê¨¢Ëøé, {{ userInfo.username }}</span>
                            <button class="btn btn-outline-secondary btn-sm" @click="logout">ÈÄÄÂá∫</button>
                        </div>
                    </div>
                </div>
                <!-- ‰æßËæπÊ†è -->
                <div class="col-md-3 sidebar p-3">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h5 class="mb-0">Ë°®ÈÖçÁΩÆÁÆ°ÁêÜ</h5>
                        <button class="btn btn-primary btn-sm" @click="showConfigModal()" data-bs-toggle="modal" data-bs-target="#configModal">
                            <i class="bi bi-plus-circle"></i> Êñ∞Âª∫
                        </button>
                    </div>
                    
                    <!-- ËøûÊé•ÈÄâÊã© -->
                    <div class="mb-3">
                        <label class="form-label small">ÈÄâÊã©ËøûÊé•:</label>
                        <select v-model="selectedConnectionId" @change="filterByConnection" class="form-select form-select-sm">
                            <option value="">ÂÖ®ÈÉ®ËøûÊé•</option>
                            <option v-for="(conn, id) in connections" :key="id" :value="id">
                                {{ conn.name }} ({{ conn.db_type }})
                            </option>
                        </select>
                    </div>

                    <!-- ÈÖçÁΩÆÂàóË°® -->
                    <div class="config-list">
                        <div v-if="filteredConfigs.length === 0" class="text-center text-muted py-4">
                            <p>ÊöÇÊó†ÈÖçÁΩÆ</p>
                        </div>
                        <div v-for="config in filteredConfigs" :key="config.id" 
                             class="config-item"
                             :class="{ active: selectedConfig?.id === config.id }"
                             @click="selectConfig(config)">
                            <div class="d-flex justify-content-between align-items-start mb-1">
                                <strong>{{ config.name }}</strong>
                                <span class="badge connection-badge" 
                                      :class="config.db_type === 'postgresql' ? 'bg-info' : 'bg-warning'">
                                    {{ config.db_type }}
                                </span>
                            </div>
                            <small class="text-muted d-block">{{ config.table_name }}</small>
                            <small class="text-muted">{{ config.connection_name }}</small>
                            <div class="mt-1">
                                <span class="badge bg-secondary">v{{ config.version }}</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ‰∏ªÂÜÖÂÆπÂå∫ -->
                <div class="col-md-9 main-content p-4">
                    <div v-if="!selectedConfig" class="text-center text-muted mt-5">
                        <h4>Ê¨¢Ëøé‰ΩøÁî®CRUD Generator</h4>
                        <p>Âü∫‰∫éJSONÈÖçÁΩÆÁöÑÂÆâÂÖ®Êï∞ÊçÆÂ∫ìËøûÊé•ÁÆ°ÁêÜ</p>
                        <div class="mt-4">
                            <h6>ÂäüËÉΩÁâπÊÄß:</h6>
                            <ul class="list-unstyled">
                                <li>‚úÖ Êï∞ÊçÆÂ∫ìËøûÊé•ÈÄöËøáJSONÊñá‰ª∂ÂÆâÂÖ®ÁÆ°ÁêÜ</li>
                                <li>‚úÖ ÊîØÊåÅPostgreSQLÂíåMySQLÊï∞ÊçÆÂ∫ì</li>
                                <li>‚úÖ ÂèØËßÜÂåñË°®ÈÖçÁΩÆÁÆ°ÁêÜ</li>
                                <li>‚úÖ Êô∫ËÉΩËøûÊé•Ê±†ÁÆ°ÁêÜ</li>
                                <li>‚úÖ SQLËØ≠Ê≥ïÈ´ò‰∫ÆÂíåÂ≠óÊÆµËß£Êûê</li>
                                <li>‚úÖ Êô∫ËÉΩÂ≠óÊÆµÈ™åËØÅ</li>
                            </ul>
                        </div>
                        <small class="text-muted">ËØ∑‰ªéÂ∑¶‰æßÈÄâÊã©‰∏Ä‰∏™ÈÖçÁΩÆËøõË°åÁºñËæëÔºåÊàñÂàõÂª∫Êñ∞ÁöÑÈÖçÁΩÆ</small>
                    </div>

                    <!-- ÈÖçÁΩÆÁºñËæëÁïåÈù¢ -->
                    <div v-if="selectedConfig">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <div>
                                <h4>{{ selectedConfig.name }}</h4>
                                <small class="text-muted">ËøûÊé•: {{ selectedConfig.connection_name }} | Ë°®: {{ selectedConfig.table_name }}</small>
                            </div>
                            <div>
                                <button class="btn btn-outline-info me-2" @click="testConnection(selectedConfig.connection_id)">
                                    ÊµãËØïËøûÊé•
                                </button>
                                <button class="btn btn-outline-warning me-2" @click="testConfigConnection(selectedConfig.id)">
                                    ÊµãËØïË°®ËÆøÈóÆ
                                </button>
                                <button class="btn btn-primary me-2" 
                                        @click="saveConfig" 
                                        :disabled="saving || validationErrors.length > 0">
                                    {{ saving ? '‰øùÂ≠ò‰∏≠...' : '‰øùÂ≠ò' }}
                                </button>
                                <button class="btn btn-danger" @click="deleteConfig">Âà†Èô§</button>
                            </div>
                        </div>

                        <div v-if="message" class="alert" :class="messageType === 'success' ? 'alert-success' : 'alert-danger'" role="alert">
                            {{ message }}
                        </div>

                        <!-- ÈÖçÁΩÆË°®Âçï -->
                        <form @submit.prevent="saveConfig">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">ÈÖçÁΩÆÂêçÁß∞ *</label>
                                        <input v-model="selectedConfig.name" class="form-control" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Ë°®Âêç *</label>
                                        <input v-model="selectedConfig.table_name" class="form-control" required>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Êï∞ÊçÆÂ∫ìËøûÊé• *</label>
                                        <select v-model="selectedConfig.connection_id" class="form-control" required>
                                            <option v-for="(conn, id) in connections" :key="id" :value="id">
                                                {{ conn.name }} ({{ conn.db_type }})
                                            </option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Ê†áÁ≠æ</label>
                                        <input v-model="selectedConfig.tags" class="form-control" placeholder="Áî®ÈÄóÂè∑ÂàÜÈöî">
                                    </div>
                                </div>
                            </div>

                            <div class="mb-3">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <label class="form-label">Âª∫Ë°®ËØ≠Âè• *</label>
                                    <button type="button" class="btn btn-outline-secondary btn-sm" @click="formatSQL('selectedConfig')">
                                        <i class="bi bi-code-square"></i> Ê†ºÂºèÂåñSQL
                                    </button>
                                </div>
                                <textarea 
                                    v-model="selectedConfig.create_statement" 
                                    @input="onCreateStatementChange"
                                    class="form-control sql-editor" 
                                    rows="8" 
                                    placeholder="ËØ∑ËæìÂÖ•CREATE TABLEËØ≠Âè•..."></textarea>
                                <div v-if="sqlFields.length > 0" class="fields-info">
                                    <strong>Ëß£ÊûêÂà∞ÁöÑÂ≠óÊÆµÔºö</strong>
                                    <span v-for="field in sqlFields" :key="field.name" class="field-tag">
                                        {{ field.name }} ({{ field.type }})
                                    </span>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">ÊèèËø∞</label>
                                <textarea v-model="selectedConfig.description" class="form-control" rows="2"></textarea>
                            </div>

                            <!-- Êü•ËØ¢ÈÖçÁΩÆ -->
                            <div class="card mb-3">
                                <div class="card-header">
                                    <h6 class="mb-0">Êü•ËØ¢ÈÖçÁΩÆ</h6>
                                </div>
                                <div class="card-body">
                                    <div class="form-check mb-3">
                                        <input v-model="selectedConfig.query_pagination" class="form-check-input" type="checkbox" id="pagination">
                                        <label class="form-check-label" for="pagination">ÂêØÁî®ÂàÜÈ°µ</label>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">
                                            Â±ïÁ§∫Â≠óÊÆµÈÖçÁΩÆ 
                                            <span class="badge bg-info ms-1 cursor-pointer" 
                                                  title="ÈÖçÁΩÆÂàóË°®È°µÈù¢ÊòæÁ§∫ÁöÑÂ≠óÊÆµÂíåÊ†áÁ≠æ" 
                                                  data-bs-toggle="tooltip" 
                                                  data-bs-placement="top">?</span>
                                        </label>
                                        <div class="border rounded p-3">
                                            <div v-for="(field, index) in selectedConfig.displayFields" :key="'display-' + index" 
                                                 class="row mb-2 sortable-item" 
                                                 draggable="true"
                                                 @dragstart="onDragStart($event, index, 'displayFields')"
                                                 @dragover="onDragOver($event)"
                                                 @drop="onDrop($event, index, 'displayFields')">
                                                <div class="col-md-auto d-flex align-items-center">
                                                    <span class="drag-handle">‚ãÆ‚ãÆ</span>
                                                </div>
                                                <div class="col-md-3">
                                                    <select v-model="field.field" 
                                                            :class="['form-control', 'form-control-sm', {'field-invalid': !isValidField(field.field)}]"
                                                            @change="validateFields">
                                                        <option value="">ÈÄâÊã©Â≠óÊÆµ</option>
                                                        <option v-for="sqlField in sqlFields" :key="sqlField.name" :value="sqlField.name">
                                                            {{ sqlField.name }} ({{ sqlField.type }})
                                                        </option>
                                                    </select>
                                                    <div v-if="!isValidField(field.field) && field.field" class="field-error">
                                                        Â≠óÊÆµ‰∏çÂ≠òÂú®‰∫éÂª∫Ë°®ËØ≠Âè•‰∏≠
                                                    </div>
                                                </div>
                                                <div class="col-md-3">
                                                    <input v-model="field.label" class="form-control form-control-sm" placeholder="ÊòæÁ§∫Ê†áÁ≠æ">
                                                </div>
                                                <div class="col-md-2">
                                                    <input v-model.number="field.width" type="number" class="form-control form-control-sm" placeholder="ÂÆΩÂ∫¶">
                                                </div>
                                                <div class="col-md-2">
                                                    <div class="form-check form-check-inline">
                                                        <input v-model="field.sortable" class="form-check-input" type="checkbox" :id="'sortable-' + index">
                                                        <label class="form-check-label" :for="'sortable-' + index">ÂèØÊéíÂ∫è</label>
                                                    </div>
                                                </div>
                                                <div class="col-md-1">
                                                    <button type="button" class="btn btn-outline-danger btn-sm" @click="removeDisplayField(index)">√ó</button>
                                                </div>
                                            </div>
                                            <button type="button" class="btn btn-outline-primary btn-sm" @click="addDisplayField()">+ Ê∑ªÂä†Â±ïÁ§∫Â≠óÊÆµ</button>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">
                                            ÊêúÁ¥¢Â≠óÊÆµÈÖçÁΩÆ 
                                            <span class="badge bg-info ms-1 cursor-pointer" 
                                                  title="ÈÖçÁΩÆÂàóË°®È°µÈù¢ÁöÑÊêúÁ¥¢ËøáÊª§Â≠óÊÆµ„ÄÇÂ≠óÂÖ∏Êù•Ê∫êÈÖçÁΩÆÔºö
                                                  
üîπ Êó†Â≠óÂÖ∏Ôºö‰∏çÊèê‰æõ‰∏ãÊãâÈÄâÊã©
üîπ Â≠óÊÆµÊü•ËØ¢ÔºöÈÄâÊã©Â≠óÊÆµÂêçÔºåËá™Âä®Êü•ËØ¢ËØ•Â≠óÊÆµÁöÑÊâÄÊúâ‰∏çÈáçÂ§çÂÄº
üîπ Ëá™ÂÆö‰πâÔºöÊâãÂä®ËæìÂÖ•ÈÄâÈ°πÔºåÊØèË°å‰∏Ä‰∏™
üîπ JSONÈÖçÁΩÆÔºöÈ´òÁ∫ßÊ®°ÂºèÔºåÊ†ºÂºèÂ¶Ç‰∏ãÔºö
{
  &quot;table&quot;: &quot;Ë°®Âêç&quot;,
  &quot;field&quot;: &quot;Â≠óÊÆµÂêç&quot;,
  &quot;sort_order&quot;: &quot;ASCÊàñDESC&quot;,
  &quot;where&quot;: &quot;Êü•ËØ¢Êù°‰ª∂(ÂèØÈÄâ)&quot;
}

Á§∫‰æãÔºö{&quot;table&quot;:&quot;users&quot;,&quot;field&quot;:&quot;status&quot;,&quot;sort_order&quot;:&quot;ASC&quot;}" 
                                                  data-bs-toggle="tooltip" 
                                                  data-bs-placement="top">?</span>
                                        </label>
                                        <div class="border rounded p-3">
                                            <div v-for="(field, index) in selectedConfig.searchFields" :key="'search-' + index" class="row mb-2">
                                                <div class="col-md-3">
                                                    <select v-model="field.field" 
                                                            :class="['form-control', 'form-control-sm', {'field-invalid': !isValidField(field.field)}]"
                                                            @change="validateFields">
                                                        <option value="">ÈÄâÊã©Â≠óÊÆµ</option>
                                                        <option v-for="sqlField in sqlFields" :key="sqlField.name" :value="sqlField.name">
                                                            {{ sqlField.name }} ({{ sqlField.type }})
                                                        </option>
                                                    </select>
                                                    <div v-if="!isValidField(field.field) && field.field" class="field-error">
                                                        Â≠óÊÆµ‰∏çÂ≠òÂú®‰∫éÂª∫Ë°®ËØ≠Âè•‰∏≠
                                                    </div>
                                                </div>
                                                <div class="col-md-2">
                                                    <input v-model="field.label" class="form-control form-control-sm" placeholder="Â±ïÁ§∫Âêç">
                                                </div>
                                                <div class="col-md-3">
                                                    <select v-model="field.type" class="form-control form-control-sm">
                                                        <option value="fuzzy">Ê®°Á≥äÊêúÁ¥¢</option>
                                                        <option value="exact">Á≤æÁ°ÆÂåπÈÖç</option>
                                                        <option value="range">ËåÉÂõ¥ÊêúÁ¥¢</option>
                                                        <option value="single">ÂçïÈÄâ</option>
                                                        <option value="multi_select">Â§öÈÄâ</option>
                                                        <option value="date_range">Êó•ÊúüËåÉÂõ¥</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-3">
                                                    <select v-model="field.dict_source_type" class="form-control form-control-sm" @change="onDictSourceTypeChange(field, index)">
                                                        <option value="">Êó†Â≠óÂÖ∏</option>
                                                        <option v-for="sqlField in sqlFields" :key="'dict-' + sqlField.name" :value="sqlField.name">
                                                            {{ sqlField.name }} ({{ sqlField.type }})
                                                        </option>
                                                        <option value="custom">Ëá™ÂÆö‰πâ</option>
                                                    </select>
                                                    <textarea v-if="field.dict_source_type === 'custom'" 
                                                              v-model="field.dict_source" 
                                                              class="form-control form-control-sm mt-1" 
                                                              rows="3"
                                                              placeholder="ËæìÂÖ•JSONÈÖçÁΩÆÊàñËá™ÂÆö‰πâÂ≠óÂÖ∏È°πÔºàÊØèË°å‰∏Ä‰∏™Ôºâ"></textarea>
                                                </div>
                                                <div class="col-md-1">
                                                    <button type="button" class="btn btn-outline-danger btn-sm" @click="removeSearchField(index)">√ó</button>
                                                </div>
                                            </div>
                                            <button type="button" class="btn btn-outline-primary btn-sm" @click="addSearchField()">+ Ê∑ªÂä†ÊêúÁ¥¢Â≠óÊÆµ</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- ÂàõÂª∫ÈÖçÁΩÆ -->
                            <div class="card mb-3">
                                <div class="card-header">
                                    <h6 class="mb-0">ÂàõÂª∫ÈÖçÁΩÆ</h6>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <label class="form-label">
                                            ÂèØÂàõÂª∫Â≠óÊÆµ 
                                            <span class="badge bg-info ms-1 cursor-pointer" 
                                                  title="ÈÖçÁΩÆÂú®Êñ∞Â¢ûË°®Âçï‰∏≠ÊòæÁ§∫ÁöÑÂ≠óÊÆµ" 
                                                  data-bs-toggle="tooltip" 
                                                  data-bs-placement="top">?</span>
                                        </label>
                                        <div class="border rounded p-3">
                                            <div v-if="selectedConfig.creatableFields && selectedConfig.creatableFields.length === 0" class="text-muted text-center py-3">
                                                ËØ∑ÂÖàËæìÂÖ•Âª∫Ë°®ËØ≠Âè•‰ª•Ëá™Âä®ÁîüÊàêÂ≠óÊÆµÈÖçÁΩÆ
                                            </div>
                                            <div v-for="(field, index) in selectedConfig.creatableFields" :key="'creatable-' + index" 
                                                 class="row mb-3 border-bottom pb-3 sortable-item"
                                                 draggable="true"
                                                 @dragstart="onDragStart($event, index, 'creatableFields')"
                                                 @dragover="onDragOver($event)"
                                                 @drop="onDrop($event, index, 'creatableFields')">
                                                <div class="col-md-auto d-flex align-items-center">
                                                    <span class="drag-handle">‚ãÆ‚ãÆ</span>
                                                </div>
                                                <div class="col-md-1">
                                                    <label class="form-label small">Â≠óÊÆµ</label>
                                                    <input v-model="field.field" class="form-control form-control-sm" readonly>
                                                </div>
                                                <div class="col-md-2">
                                                    <label class="form-label small">ÊòæÁ§∫Ê†áÁ≠æ</label>
                                                    <input v-model="field.label" class="form-control form-control-sm" placeholder="Â≠óÊÆµÊ†áÁ≠æ">
                                                </div>
                                                <div class="col-md-1">
                                                    <label class="form-label small">ËæìÂÖ•Á±ªÂûã</label>
                                                    <select v-model="field.type" class="form-control form-control-sm">
                                                        <option value="text">ÊñáÊú¨ËæìÂÖ•</option>
                                                        <option value="textarea">Â§öË°åÊñáÊú¨</option>
                                                        <option value="number">Êï∞Â≠ó</option>
                                                        <option value="date">Êó•Êúü</option>
                                                        <option value="datetime">Êó•ÊúüÊó∂Èó¥</option>
                                                        <option value="select">‰∏ãÊãâÈÄâÊã©</option>
                                                        <option value="checkbox">Â§çÈÄâÊ°Ü</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-2">
                                                    <label class="form-label small">ÈªòËÆ§ÂÄº</label>
                                                    <select v-model="field.default_type" 
                                                            class="form-control form-control-sm"
                                                            :class="{'is-invalid': field.type === 'readonly' && !field.default_type}">
                                                        <option value="">Êó†ÈªòËÆ§ÂÄº</option>
                                                        <option value="fixed">Âõ∫ÂÆöÂÄº</option>
                                                        <option value="auto_increment" v-if="isAutoIncrementSupported(field.field)">Ëá™Â¢û</option>
                                                        <option value="current_time">ÂΩìÂâçÊó∂Èó¥</option>
                                                        <option value="uuid">UUID</option>
                                                    </select>
                                                    <input v-if="field.default_type === 'fixed'" 
                                                           v-model="field.default_value" 
                                                           class="form-control form-control-sm mt-1" 
                                                           :class="{'is-invalid': field.type === 'readonly' && field.default_type === 'fixed' && !field.default_value}"
                                                           placeholder="ÈªòËÆ§ÂÄº"
                                                           :required="field.type === 'readonly' && field.default_type === 'fixed'">
                                                    <div v-if="field.type === 'readonly' && !field.default_type" class="invalid-feedback">
                                                        ‰∏çÂèØÁºñËæëÂ≠óÊÆµÂøÖÈ°ªÈÖçÁΩÆÈªòËÆ§ÂÄº
                                                    </div>
                                                    <div v-if="field.type === 'readonly' && field.default_type === 'fixed' && !field.default_value" class="invalid-feedback">
                                                        ËØ∑ËæìÂÖ•Âõ∫ÂÆöÈªòËÆ§ÂÄº
                                                    </div>
                                                </div>
                                                <div class="col-md-1">
                                                    <label class="form-label small">ÂøÖÂ°´</label>
                                                    <div class="form-check">
                                                        <input v-model="field.required" class="form-check-input" type="checkbox" :id="'required-' + index">
                                                        <label class="form-check-label" :for="'required-' + index">ÂøÖÂ°´</label>
                                                    </div>
                                                </div>
                                                <div class="col-md-1">
                                                    <label class="form-label small">‰∏çÂèØÁºñËæë</label>
                                                    <div class="form-check">
                                                        <input v-model="field.user_readonly" class="form-check-input" type="checkbox" :id="'user-readonly-' + index">
                                                        <label class="form-check-label" :for="'user-readonly-' + index">‰∏çÂèØÁºñËæë</label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Êõ¥Êñ∞ÈÖçÁΩÆ -->
                            <div class="card mb-3">
                                <div class="card-header">
                                    <h6 class="mb-0">Êõ¥Êñ∞ÈÖçÁΩÆ</h6>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <label class="form-label">
                                            ÂèØÊõ¥Êñ∞Â≠óÊÆµ 
                                            <span class="badge bg-info ms-1 cursor-pointer" 
                                                  title="ÈÖçÁΩÆÂú®ÁºñËæëË°®Âçï‰∏≠ÊòæÁ§∫ÁöÑÂ≠óÊÆµ" 
                                                  data-bs-toggle="tooltip" 
                                                  data-bs-placement="top">?</span>
                                        </label>
                                        <div class="border rounded p-3">
                                            <div v-if="selectedConfig.updatableFields && selectedConfig.updatableFields.length === 0" class="text-muted text-center py-3">
                                                ËØ∑ÂÖàËæìÂÖ•Âª∫Ë°®ËØ≠Âè•‰ª•Ëá™Âä®ÁîüÊàêÂ≠óÊÆµÈÖçÁΩÆ
                                            </div>
                                            <div v-for="(field, index) in selectedConfig.updatableFields" :key="'updatable-' + index" 
                                                 class="row mb-3 border-bottom pb-3"
                                                 :class="{'sortable-item': !field.is_primary_key}"
                                                 :draggable="!field.is_primary_key"
                                                 @dragstart="!field.is_primary_key && onDragStart($event, index, 'updatableFields')"
                                                 @dragover="!field.is_primary_key && onDragOver($event)"
                                                 @drop="!field.is_primary_key && onDrop($event, index, 'updatableFields')">
                                                <div class="col-md-auto d-flex align-items-center">
                                                    <span v-if="!field.is_primary_key" class="drag-handle">‚ãÆ‚ãÆ</span>
                                                    <span v-else class="text-muted" style="width: 16px;">üîí</span>
                                                </div>
                                                <div class="col-md-2">
                                                    <label class="form-label small">Â≠óÊÆµ</label>
                                                    <input v-model="field.field" class="form-control form-control-sm" readonly>
                                                    <small v-if="field.is_primary_key" class="text-muted">‰∏ªÈîÆÂ≠óÊÆµ</small>
                                                </div>
                                                <div class="col-md-2">
                                                    <label class="form-label small">ÊòæÁ§∫Ê†áÁ≠æ</label>
                                                    <input v-model="field.label" class="form-control form-control-sm" placeholder="Â≠óÊÆµÊ†áÁ≠æ">
                                                </div>
                                                <div class="col-md-2">
                                                    <label class="form-label small">ËæìÂÖ•Á±ªÂûã</label>
                                                    <select v-model="field.type" class="form-control form-control-sm" :disabled="field.is_primary_key">
                                                        <option value="text">ÊñáÊú¨ËæìÂÖ•</option>
                                                        <option value="textarea">Â§öË°åÊñáÊú¨</option>
                                                        <option value="number">Êï∞Â≠ó</option>
                                                        <option value="date">Êó•Êúü</option>
                                                        <option value="datetime">Êó•ÊúüÊó∂Èó¥</option>
                                                        <option value="select">‰∏ãÊãâÈÄâÊã©</option>
                                                        <option value="checkbox">Â§çÈÄâÊ°Ü</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-2">
                                                    <label class="form-label small">ÈªòËÆ§ÂÄº</label>
                                                    <select v-model="field.default_type" 
                                                            class="form-control form-control-sm"
                                                            :class="{'is-invalid': field.type === 'readonly' && !field.default_type}">
                                                        <option value="">Êó†ÈªòËÆ§ÂÄº</option>
                                                        <option value="fixed">Âõ∫ÂÆöÂÄº</option>
                                                        <option value="auto_increment" v-if="isAutoIncrementSupported(field.field)">Ëá™Â¢û</option>
                                                        <option value="current_time">ÂΩìÂâçÊó∂Èó¥</option>
                                                        <option value="uuid">UUID</option>
                                                    </select>
                                                    <input v-if="field.default_type === 'fixed'" 
                                                           v-model="field.default_value" 
                                                           class="form-control form-control-sm mt-1" 
                                                           :class="{'is-invalid': field.type === 'readonly' && field.default_type === 'fixed' && !field.default_value}"
                                                           placeholder="ÈªòËÆ§ÂÄº"
                                                           :required="field.type === 'readonly' && field.default_type === 'fixed'">
                                                    <div v-if="field.type === 'readonly' && !field.default_type" class="invalid-feedback">
                                                        ‰∏çÂèØÁºñËæëÂ≠óÊÆµÂøÖÈ°ªÈÖçÁΩÆÈªòËÆ§ÂÄº
                                                    </div>
                                                    <div v-if="field.type === 'readonly' && field.default_type === 'fixed' && !field.default_value" class="invalid-feedback">
                                                        ËØ∑ËæìÂÖ•Âõ∫ÂÆöÈªòËÆ§ÂÄº
                                                    </div>
                                                </div>
                                                <div class="col-md-1">
                                                    <label class="form-label small">È™åËØÅ</label>
                                                    <div class="form-check">
                                                        <input v-model="field.required" class="form-check-input" type="checkbox" :id="'update-required-' + index" :disabled="field.is_primary_key">
                                                        <label class="form-check-label" :for="'update-required-' + index">ÂøÖÂ°´</label>
                                                    </div>
                                                </div>
                                                <div class="col-md-1">
                                                    <label class="form-label small">Áî®Êà∑ËæìÂÖ•</label>
                                                    <div class="form-check">
                                                        <input v-model="field.user_input_required" class="form-check-input" type="checkbox" :id="'update-user-input-' + index" :disabled="field.is_primary_key">
                                                        <label class="form-check-label" :for="'update-user-input-' + index">Áî®Êà∑ÂèØÁºñËæë</label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Êñ∞Âª∫ÈÖçÁΩÆÊ®°ÊÄÅÊ°Ü -->
        <div class="modal fade" id="configModal" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Êñ∞Âª∫Ë°®ÈÖçÁΩÆ</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <form>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">ÈÖçÁΩÆÂêçÁß∞ *</label>
                                        <input v-model="newConfig.name" class="form-control" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Ë°®Âêç *</label>
                                        <input v-model="newConfig.table_name" class="form-control" required>
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Êï∞ÊçÆÂ∫ìËøûÊé• *</label>
                                <select v-model="newConfig.connection_id" class="form-control" required>
                                    <option value="">ËØ∑ÈÄâÊã©ËøûÊé•</option>
                                    <option v-for="(conn, id) in connections" :key="id" :value="id">
                                        {{ conn.name }} ({{ conn.db_type }})
                                    </option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <label class="form-label">Âª∫Ë°®ËØ≠Âè• *</label>
                                    <button type="button" class="btn btn-outline-secondary btn-sm" @click="formatSQL('newConfig')">
                                        <i class="bi bi-code-square"></i> Ê†ºÂºèÂåñSQL
                                    </button>
                                </div>
                                <textarea 
                                    v-model="newConfig.create_statement" 
                                    @input="onNewConfigCreateStatementChange"
                                    class="form-control sql-editor" 
                                    rows="8" 
                                    placeholder="ËØ∑ËæìÂÖ•CREATE TABLEËØ≠Âè•..."></textarea>
                                <div v-if="newSqlFields.length > 0" class="fields-info">
                                    <strong>Ëß£ÊûêÂà∞ÁöÑÂ≠óÊÆµÔºö</strong>
                                    <span v-for="field in newSqlFields" :key="field.name" class="field-tag">
                                        {{ field.name }} ({{ field.type }})
                                    </span>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ÂèñÊ∂à</button>
                        <button type="button" class="btn btn-primary" @click="createConfig" :disabled="creating">
                            {{ creating ? 'ÂàõÂª∫‰∏≠...' : 'ÂàõÂª∫' }}
                        </button>
                    </div>
                </div>
            </div>
        </div>
        </div> <!-- ËÆ§ËØÅ‰∏ªÁïåÈù¢ÁªìÊùü -->
    </div>

    <script src="/webui/app.js"></script>
</body>
</html>